<div class="container">
    <div class="card">
        <div class="row">
            <div class="card-content">
                <form *ngIf="scholarship" #scholarshipForm="ngForm" class="col s12">
                    <h4>Edit Scholarship</h4>
                    <h4>{{scholarship.name}}</h4>
                    <div *ngIf="pageNo==1">
                        <h5>General Information {{pageNo}}/3</h5>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="name" type="text" required placeholder="Scholarship Name" [(ngModel)]="scholarship.name" name="name" disabled>
                            </mat-form-field>
                        </div>

                      <div class="row">
                          <label> Describe the scholarship in a concise tweet (140 characters). You will be able to give more details later.</label><br>
                            <textarea  class="browser-default" matInput id="description" type="text"
                            required placeholder="Description" [(ngModel)]="scholarship.description" name="description"></textarea>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="scholarship_url" type=url placeholder="Schlarship URL" [(ngModel)]="scholarship.scholarship_url" name="scholarship_url">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="form_url" type=url placeholder="Form URL" [(ngModel)]="scholarship.form_url" name="form_url">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="img_url" type=url placeholder="Scholarship Image URL" [(ngModel)]="scholarship.img_url" name="img_url">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="funding_amount" type="number" placeholder="Funding Amount" [(ngModel)]="scholarship.funding_amount" name="funding_amount">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="number_available_scholarships" type="number" placeholder="Number of Available Scholarships" [(ngModel)]="scholarship.number_available_scholarships" name="number_available_scholarships" value="1">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s6">
                              <label>Deadline</label>
                              <br/>
                              <input class="browser-default" matInput id="deadline" type="datetime-local" required
                                [(ngModel)]="scholarship.deadline" name="deadline">
                            </mat-form-field>


                          <span *ngIf="scholarship.deadline" class="col s6">
                            <!-- TODO: Wrong time zone offset on deadline -->
                              Deadline: {{ scholarship.deadline | date:'fullDate' }} {{ scholarship.deadline | date:'shortTime' }}
                              <br>
                              <small>Please note that due to time zone differences, deadlines may be a few hours different from the time shown.</small>
                          </span>

                          </div>
                        <label>Leave the city, province/state or country field blank, if there is no restriction for the respective place. Seperate multiple cities, provinces/states or countries with a comma.</label>
                        <!-- Location Data -->
                        {{ myJson.stringify(countries) }}
                        {{ myJson.stringify(provinces) }}
                        {{ myJson.stringify(cities) }}
                        <br>
                        <div class="row">
                            <div class="col s12 location-input-row">

                            <label> Add a country </label>
                                <div *ngFor="let country of countries; let i=index; trackBy:trackByFn">
                                        <input [value]="country.country" type="text" (change)='editLocation(i, "countries", $event)'/><br/>
                                        <button class="btn location-btn" (click)="removeLocation(i,'countries',country)">Remove Country<i class="material-icons md-light">add_circle_outline</i></button>
                                </div>
                                <div>
                                    <button class="btn location-btn" (click)="createLocation('countries')">Add Country<i class="material-icons md-light">add_circle_outline</i></button>
                                </div>
                            </div>


                            <div class="col s12 location-input-row">

                            <label> Select a Country, THEN click add a Province/State </label>
                                <!-- https://stackoverflow.com/questions/33700266/how-can-i-get-new-selection-in-select-in-angular-2 -->
                                <div *ngFor="let province of provinces; let i=index; trackBy:trackByFn">
                                    <div class="input-field">
                                            <mat-select class="col s6" (change)="setActiveLocation($event, 'country')"  name="country-dropdown" id="country-dropdown" multiple=false placeholder="Country">
                                                <mat-option *ngFor="let country of countries" [value]="country.country">{{country.country}} </mat-option>
                                            </mat-select>
                                    </div>
                                        <div class="col s6">
                                            <input [value]="province.province" type="text" (change)='editLocation(i, "provinces", $event)'/><br/>
                                            <button class="btn location-btn" (click)="removeLocation(i,'provinces',province)">Remove Province<i class="material-icons md-light">add_circle_outline</i></button>
                                            </div>
                                </div>
                                <div>
                                    <button class="btn location-btn" (click)="createLocation('provinces')">Add Province<i class="material-icons md-light">add_circle_outline</i></button>
                                </div>

                            </div>

                            <div class="col s12 location-input-row">
                            <label> Select a Province/State, THEN click Add City</label>
                                <!-- https://stackoverflow.com/questions/33700266/how-can-i-get-new-selection-in-select-in-angular-2 -->

                                <div *ngFor="let city of cities; let i=index; trackBy:trackByFn" class="col s12">
                                    <div class="input-field">
                                            <mat-select class="col s6" (change)="setActiveLocation($event, 'province')"  name="province-dropdown" id="province-dropdown" multiple=false placeholder="province">
                                                <mat-option *ngFor="let province of provinces" [value]="province.province">{{province.province}} </mat-option>
                                            </mat-select>
                                    </div>
                                        <div class="col s6">
                                            <input [value]="city.city" type="text" (change)='editLocation(i, "cities", $event)'/><br/>
                                            <button class="btn location-btn" (click)="removeLocation(i,'cities',city)">Remove city<i class="material-icons md-light">add_circle_outline</i></button>
                                        </div>
                                </div>
                                <div>
                                    <button class="btn location-btn" (click)="createLocation('cities')">Add city<i class="material-icons md-light">add_circle_outline</i></button>
                                </div>

                            </div>

                            <!-- <div class="row">
                                        <mat-form-field class="col s12">
                                            <input class="browser-default" type="text" matInput [(ngModel)]="this.stringDict['city']" name="city" id="city" placeholder="City" value="Any" (change)="stringInputToArray($event)">
                                        </mat-form-field>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="col s12">
                                            <input class="browser-default" type="text" matInput [(ngModel)]="this.stringDict.province" name="province" id="province" placeholder="Province or State" (change)="stringInputToArray($event)">
                                        </mat-form-field>
                                    </div>
                                    <div class="row">
                                        <mat-form-field class="col s12">
                                            <input class="browser-default" type="text" matInput [(ngModel)]="this.stringDict['elgible_schools']" name="country" id="country" placeholder="Country" (change)="stringInputToArray($event)">
                                        </mat-form-field>
                                    </div>
                                -->
                        </div>


                        <br>
                        <div class="row">
                            <div class="input-field">
                                <mat-select class="col s12" [(ngModel)]="scholarship.funding_type" name="funding_type" id="funding_type" multiple=true placeholder="Funding Type">
                                    <mat-option *ngFor="let type of FUNDING_TYPES" [value]="type">{{type}} </mat-option>
                                </mat-select>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="input-field">
                                <mat-select class="col s12" [(ngModel)]="scholarship.education_level" name="education_level" id="education_level" multiple=true placeholder="Education Level">
                                    <mat-option *ngFor="let education_level of EDUCATION_LEVELS" [value]="education_level">{{education_level}} </mat-option>
                                </mat-select>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="input-field">
                                <mat-select class="col s12" [(ngModel)]="scholarship.education_field" name="education_field" id="education_field" multiple=true required placeholder="Education Field">
                                    <mat-option *ngFor="let education_field of EDUCATION_FIELDS" [value]="education_field">{{education_field}} </mat-option>
                                </mat-select>
                            </div>

                            <a class="waves-effect waves-light btn left" (click)="saveScholarshipEdit(scholarshipForm)">Save</a>
                            <a class="waves-effect waves-light btn right" (click)="next()">Next</a>
                        </div>
                        <br>
                    </div>

                    <div *ngIf="pageNo==2">
                        <h5>General Information {{pageNo}}/3</h5>

                        <div class="row">
                                <div class="col s12">
                                    <input class="browser-default" id="is_automated" type="checkbox" [(ngModel)]="scholarship.is_automated" name="is_automated">
                                    <label for="is_automated" data-error="Invalid input">Can this form be automated by Atila?<a> What is an automatable form?</a></label>
                                </div>
                        </div>
                        <div class="row">
                            <div class="input-field">
                                <mat-select class="col s12" [(ngModel)]="scholarship.submission_info.application_form_type" name="application_form_type" id="application_form_type" placeholder="Application Form Type">
                                    <mat-option *ngFor="let type of APPLICATION_FORM_TYPES" [value]="type">{{type}} </mat-option>
                                </mat-select>
                            </div>
                            <label for="application_form_type" data-error="Invalid input">What type of form is the application?</label>
                        </div>

                        <div class="row">
                            <mat-form-field class="col s12">
                                <label>Is the scholarship restricted to students attending certain schools?</label>
                                <input class="browser-default" type="text" matInput [(ngModel)]="this.stringDict.eligible_schools" name="eligible_schools" id="eligible_schools" placeholder="Eligible Schools" (change)="stringInputToArray($event)">
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <div class="col s12">
                                <input class="browser-default" id="resume_required" type="checkbox" [(ngModel)]="scholarship.resume_required" name="resume_required">
                                <label for="resume_required" data-error="Invalid input">Resume required?</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s12">
                                <input class="browser-default" id="transcript_required" type="checkbox" [(ngModel)]="scholarship.transcript_required" name="transcript_required">
                                <label for="transcript_required" data-error="Invalid input">Transcript required?</label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col s12">
                                <input class="browser-default" id="enrollment_proof_required" type="checkbox" [(ngModel)]="scholarship.enrollment_proof_required" name="enrollment_proof_required">
                                <label for="enrollment_proof_required" data-error="Invalid input">Proof of Enrollment required?</label>
                            </div>
                        </div>
                        <div class="row">
                            <mat-form-field class="col s12">
                                <input class="browser-default" matInput id="reference_letter_required" type="number" [(ngModel)]="scholarship.reference_letter_required" name="reference_letter_required">
                                <label for="reference_letter_required" data-error="Invalid input">Number of reference letters required? (Leave as 0 if reference letter is not required.)</label>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <label for="criteria_info">Are there any additional criteria that were not covered by the previous questions? </label>
                              <textarea  class="browser-default" matInput id="criteria_info" type="text" placeholder="Criteria Description" [(ngModel)]="scholarship.criteria_info" name="criteria_info"></textarea>
                        </div>
                        <div *ngIf="showFormUpload"class="row">
                                <div class="col s3">
                                    <span *ngIf="scholarship.form_url">
                                            <label>Change application form</label>
                                    </span>
                                    <span *ngIf="!scholarship.form_url">
                                        <label>Upload an application form</label>
                                    </span>
                                    <input class="browser-default" id="user_img_file" type="file" placeholder="Profile Picture" [(ngModel)]="scholarship.user_img_file" name="user_img_file" (change)="scholarshipAppFormChangeEvent($event)">
                                </div>
                                <div class="col s3">
                                    <button mat-raised-button class="btn white-text" (click)="uploadScholarshipAppForm()">Upload</button>
                                </div>

                                <!-- <div class="col s6">
                                        <input class="browser-default" matInput id="form_url" type="text" minlength="2" placeholder="Scholarship Form Url"
                                          [(ngModel)]="scholarship.form_url" name="form_url">
                                </div> -->
                                <!-- <div *ngIf="uploadFile" class="col s6">
                                {{uploadFile.name}} {{uploadResponse}} {{scholarship.form_url}}
                                </div>  -->

                                <div *ngIf="scholarship.form_url" class="col s4">
                                        <a target="_blank" href="{{scholarship.form_url}}">View Current Application</a>
                                </div>
                                <a routerLink="/scholarships-list">Skip</a>
                            </div>
                        <div class="row">
                            <div class="col s12">
                                <a class="waves-effect waves-light btn left" (click)="back()">Back</a>
                                <a class="waves-effect waves-light btn left"  style="margin-left: 5%;"(click)="saveScholarshipEdit(scholarshipForm)">Save</a>
                                <a class="waves-effect waves-light btn right" (click)="next()">Next</a>
                            </div>
                        </div>
                    </div>
                    <!-- TODO: Seperate Application Questions and Web Form into 2 seperate pages  -->
                    <div *ngIf="pageNo==3">
                        <h5>Application Questions{{pageNo}}/3</h5>
                        <ol *ngIf="scholarship.extra_questions">
                            <li *ngFor="let question of generateArray(scholarship.extra_questions);let i = index" class="questions row">
                                <div class="col s3">Type: {{question.controlType}}
                                  </div>
                                <div class="col s3">Question: {{question.label}}
                                  </div>
                                <div class="col s3">Key: {{question.key}}
                                </div>
                                <div class="col s3">
                                    <a class="waves-effect waves-light btn left" (click)="edit(question.key)">
                                        <i class="fa fa-pencil"></i>
                                    </a>
                                    <a class="waves-effect waves-light btn right" (click)="delete(question.key)">
                                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </li>
                        </ol>
                        <div class="row">
                            <div class="col s12">
                                <button class="waves-effect waves-light btn center" (click)="openModal()">
                                    <i class="fa fa-plus" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                        <!--  Start Web form details -->
                        <div class="container-fluid"  *ngIf="this.scholarship.submission_info.application_form_type=='Web' && this.scholarship.is_automated" > <!-- Web form details -->
                            <h5>Web Form Questions{{pageNo}}/3</h5>
                            <div class="page-header">
                                <h1>{{ title }}</h1>
                            </div>
                            <table class="table">
                                    <h6>Form Parent Description</h6>
                                    <tr>
                                      <th>Element Type</th>
                                      <th>Element Attribute</th>
                                      <th>Attribute Value</th>
                                    </tr>
                                    <tr>
                                      <td><input [(ngModel)]="scholarship.submission_info.web_form_parent.element_type" name="web_form_parent.element_type" class="browser-default" placeholder="ex. div"></td>
                                      <td><input [(ngModel)]="scholarship.submission_info.web_form_parent.attribute_type" name="web_form_parent.attribute_type" class="browser-default" placeholder="ex. id"></td>
                                      <td><input [(ngModel)]="scholarship.submission_info.web_form_parent.attribute_value" name="web_form_parent.attribute_value" class="browser-default" placeholder="ex. myFormId"></td>
                                    </tr>
                                  </table>
                            <!-- display the web form editing table if appropriate for this scholarship and it is automated -->
                            <my-table [records]="webForms"
                            [caption]="'Web Form Entries'" (tableEditEvent)="saveTableChanges($event)">
                            </my-table>
                            <!-- <my-table [records]="projects"
                                      [caption]="'NASA Projects'"
                                      [settings]="projectSettings">
                            </my-table> -->
                            <!-- <my-table [records]="people"
                                      [caption]="'NASA Astronauts'"
                                      >
                            </my-table> -->
                        </div>  <!--  ENDWeb form details -->
                        <div class="row">
                            <div class="col s12">
                                <div *ngIf="showFormUpload">
                                    <div class="row">
                                        <div class="col s3">
                                            <label>Upload an application form</label>
                                            <input class="browser-default" id="user_img_file" type="file" placeholder="Profile Picture" [(ngModel)]="scholarship.user_img_file" name="user_img_file" (change)="scholarshipAppFormChangeEvent($event)">
                                        </div>
                                        <div class="col s3">
                                            <button mat-raised-button class="btn white-text" (click)="uploadScholarshipAppForm()">Upload</button>
                                            {{uploadResponse}}
                                        </div>
                                        <a routerLink="/scholarships-list">Skip</a>
                                    </div>
                                </div>
                                <a class="waves-effect waves-light btn left" (click)="back()">Back</a>
                                <a class="waves-effect waves-light btn right" (click)="saveScholarshipEdit(scholarshipForm)">Save</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
