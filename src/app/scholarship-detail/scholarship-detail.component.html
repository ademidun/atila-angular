<div class="container" *ngIf="scholarship">
  <div class="row">
    <div class="col s12">
      <img class="scholarship-image" [src]="scholarship.img_url" />
    </div>
    <div class="col s12">
      <h3>{{scholarship.name}}</h3>
      <div class="sub-header">

          <div class="date-created">
            <div *ngIf="scholarshipOwner">
              Added by: <a routerLink="/profile/{{scholarshipOwner.username}}">{{scholarshipOwner.first_name}} {{scholarshipOwner.last_name}}</a>
            </div>
            Deadline: <span *ngIf="!this.scholarship['metadata']['deadline_tbd']">{{scholarship.deadline | date:'longDate'}}</span>
            <span  *ngIf="this.scholarship['metadata']['deadline_tbd']">{{this.scholarship['metadata']['deadline_tbd']}}</span><br>
            <strong>
            <p *ngIf="scholarship.funding_amount > 0">{{scholarship.funding_amount | currency:'USD':'symbol':'1.0-0'}}</p>
            </strong>
            <a *ngIf="scholarship.owner==userId" [routerLink]="['/edit-scholarship', scholarship.slug]"> Edit Scholarship </a><br>
            <a *ngIf="scholarship.owner!=userId" [routerLink]="['/edit-scholarship', scholarship.slug]"> Suggest/View Edits </a><br>
            <a target="_blank" *ngIf="scholarship.form_url" href="{{scholarship.form_url}}"> View Application Form </a><br>
            <a target="_blank" *ngIf="scholarship.scholarship_url" href="{{scholarship.scholarship_url}}"> Visit Scholarship Website </a> <br>
            <a target="_blank" *ngIf="scholarship.local_form_location.indexOf('scholartree') !== -1;" href="https://scholartree.ca">Source</a> <br>
          </div>


        <p class="col offset-m5">Save for Later</p>
        <button mat-fab  (click)="addToMyScholarships(scholarship)" style="margin-left: -7%">
          <mat-icon [ngStyle]="{'color': alreadySaved ? '#4080ff' : ''}"  class="atila-blue" aria-hidden="true" aria-label="Save">bookmark</mat-icon>
        </button>

        <button mat-raised-button *ngIf=scholarship.is_automated (click)="getOrCreateApp()"
        style="background-color: #4080ff; " class="white-text">Apply now</button>

        <div  *ngIf=!scholarship.is_automated class="col s6 m4">
          <p>Request Automation and we'll automate the scholarship for you.</p>
          <button mat-raised-button (click)="requestAutomation()"
                  style="background-color: #4080ff; min-height: 60px" class="white-text">Request Automation</button>
        </div>

      </div>
      <br>
      <div class="divider"></div>
      <p>{{scholarship.description}}</p>
    </div>
  </div>
  <div class="row">
    <div class="col s12">
      <h4>Criteria</h4>
      <ul>
        <li style="white-space: pre-line">

          <markdown [data]="scholarship.criteria_info"></markdown>
          <!--{{scholarship.criteria_info}}-->

        </li>
      </ul>
      <ul>
        <!-- TODO: THis should actually be done using a pipe https://stackoverflow.com/questions/35534959/access-key-and-value-of-object-using-ngfor -->

        <li *ngIf="scholarship.city">Located in:
            {{keyGetter(scholarship.city)}}
         </li>
        <li>Field: {{scholarship.education_field}}</li>
      </ul>
    </div>

  </div>

  <div class="row">
      <div class="col s12 forum-box">
          <h5 > Comments </h5>

                  <mat-card class="comment-card">

                    <mat-card-content>
                        <input id="comment_title" placeholder="Title" [(ngModel)]="userComment.title">
                        <textarea style="height: 5rem" id="comment_title" placeholder="What do you think?" [(ngModel)]="userComment.text">
                        </textarea>
                    </mat-card-content>

                    <mat-card-actions>
                        <button mat-raised-button style="background-color: #184E87;" class="btn white-text" (click)="postComment()">Post</button>
                    </mat-card-actions>

                  </mat-card>

                  <div  *ngFor="let comment of scholarshipComments; i as index; first as isFirst; trackBy:trackByFn" class="forum-comments">
                      <app-comment  [comment]="comment" commentType="Forum"> </app-comment>
                  </div>

      </div>

  </div>
</div>



<!-- Loading progress circle -->
<div *ngIf="!scholarship" class="preloader-background">
  <div class="preloader-wrapper big active">
    <div class="spinner-layer spinner-blue-only">
      <div class="circle-clipper left">
        <div class="circle"></div>
      </div>
      <div class="gap-patch">
        <div class="circle"></div>
      </div>
      <div class="circle-clipper right">
        <div class="circle"></div>
      </div>
    </div>
  </div>
</div>
